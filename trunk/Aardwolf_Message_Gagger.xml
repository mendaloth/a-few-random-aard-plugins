<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 06, 2008, 1:13 PM -->
<!-- MuClient version 4.35 -->

<!-- Plugin "Consider_info" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aardwolf_Message_Gagger"
   author="Mendaloth"
   id="525d96c10d790146f435e802"
   language="Lua"
   purpose="Gags Messages"
   date_written="2008-10-15 07:35"
   requires="4.30"
   version="1.0"
   save_state="y"
   >
<description trim="y">
<![CDATA[


<=================== ACTIONS ===================>
gagger help                   --> Displays this message.                                 
gagger info                   --> Displays basic info on the plugin.
gagger off/on                 --> Toggles the gagging on/off.
gagger <deity>                --> Sets the deity as listed in
                                > claninfo and appearing in many
                                > spellup messages.							 

]]>
</description>

</plugin>


<!--  Triggers  -->

<triggers>
  
</triggers>

<aliases>
        <alias
   match="gagger off"
   enabled="y"
   send_to="12"
   sequence="100"
   expand_variables="y"
  >
  <send>
      Show_Plugin_Info()
  	  Delete_All_Triggers()
	  messages_to_be_gagged = 0
	  Note("Gagging disabled.")
	</send>
  </alias>
  
          <alias
   match="gagger on"
   enabled="y"
   send_to="12"
   sequence="100"
   expand_variables="y"
  >
  <send>
	  Delete_All_Triggers() -- just in case it was already on...
	  Create_Gag_Triggers()
	  Show_Plugin_Info()
	  Note("Gagging enabled.")
	</send>
  </alias>
  
            <alias
   match="gagger info"
   enabled="y"
   send_to="12"
   sequence="1"
   expand_variables="y"
  >
  <send>
      Show_Plugin_Info()
	</send>
  </alias>
  
        <alias
   match="gagger *"
   enabled="y"
   send_to="12"
   sequence="110"
   expand_variables="y"
  >
  <send>
  	player_deity = "%1"
	SaveState()
	Note("The player deity has been set to '" .. player_deity .. "'.")
	Note("Recreating the triggers now for your new deity.")
	Delete_All_Triggers() -- just in case it was already on...
	Create_Gag_Triggers()
	</send>
  </alias>
  
  
      <alias
   match="gagger help"
   enabled="y"
   send_to="12"
  >

<send>
  Note(GetPluginInfo (GetPluginID(), 3))
</send> 
  </alias>
 
  
</aliases>



<!--  Script  -->


<script>
<![CDATA[

triggers_gagged = 0  --global variable to keep track of how many messages have been gagged.
messages_to_be_gagged = 0

require "addxml"

function OnPluginInstall ()
	player_deity = GetVariable("player_deity") or "Ayla"
	Create_Gag_Triggers()
	Note("Gag plugin loaded. There are " .. messages_to_be_gagged .. " messages that are currently being gagged.")
end

function OnPluginSaveState ()
	SetVariable ("player_deity", player_deity)
end -- function OnPluginSaveState

function Show_Plugin_Info()
	Note("The plugin has gagged " .. triggers_gagged .. " messages this session.  There are " .. messages_to_be_gagged .. " messages that are currently being gagged.")
	Note("Your diety is currently set to '" .. player_deity .. "'")
end
function Delete_All_Triggers()
	DeleteTriggerGroup ("message_gagger")
end

function Create_Gag_Triggers()
	messages_to_be_gagged = 0
	for line in io.lines (GetInfo (56) .. "messages_to_gag.txt") do
		if line ~= "" then
			messages_to_be_gagged = messages_to_be_gagged + 1
	
			local message_to_gag = string.gsub(line, "<deity>", player_deity)  
			
			addxml.trigger {  match = message_to_gag, 
								regexp = false,
								sequence = 50,
								enabled = true,
								omit_from_output = true,
								group = "message_gagger",
								send_to = 12,
								send = "triggers_gagged = triggers_gagged + 1"
							  }
		end -- if
	end 
	io.flush ()
end

]]>
</script>

</muclient>