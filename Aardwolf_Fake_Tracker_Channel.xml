<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Wednesday, August 06, 2008, 1:13 PM -->
<!-- MuClient version 4.35 -->

<!-- Plugin "Consider_info" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aardwolf_Fake_Tracker_Channel"
   author="Mendaloth"
   id="9a386e25e87cd9ed2311c961"
   language="Lua"
   purpose="Allows use of a fake tracker channel, along with history."
   date_written="2008-10-15 07:35"
   requires="4.89"
   sequence="-5001"
   version="1.0"
   save_state="y"
   >
<description trim="y">
<![CDATA[
Aardwolf Fake Tracker Channel v 1.2.1

<=================== ACTIONS ===================>
tracker help                   --> Displays this message.
tracker -h                     --> Displays up to 100 of the last tracker
                                 > channel messages.
tracker tab                    --> Displays the current tab name
tracker tab <tabname>          --> Sets the tab name of Fiendish's
                                 > Communication Log window.  Tab
                                 > functionality was added in snapshot
                                 > r1981.
tracker tab clear              --> Unsets the tab name
tracker                        --> To use just set your tracker plugins to
                                 > send to channel "tracker".


<==================== SETUP ====================>
1) Create a mudside alias using this command:
      "alias tracker echo @r[@RTracker@r]@w:"
  Note: You can change the color codes to whatever you like, but the [Tracker]:
     is required.  If you had a previous version of this plugin note that the
     alias has changed and will need to be updated.


<========== WHY IS IT SETUP LIKE THIS?==========>
In case you are wondering why a plugin would require a mudside alias:
The mudside alias is the cleanest way to create this plugin. That way it will work
with all your existing plugins.  If it was a Mushclient alias all the existing
plugins that have channels set would need to send to Execute.

-------------------------------------------------
]]>
</description>

</plugin>


<!--  Triggers  -->

<triggers>
   <trigger
   match="^\[Tracker\]\:(.*?)$"
   regexp="y"
   script="ProcessTrackerMessage"
   send_to="10"
   sequence="100"
   enabled="y"
  >
  </trigger>
</triggers>

<aliases>
   <alias
   script="Print_Tracker_History"
   match="tracker -h"
   enabled="y"
   send_to="12"
   sequence="100"
  >
  </alias>

  <alias
	match="tracker help"
	enabled="y"
	echo_alias="y"
	send_to="12"
	sequence="101">
		<send>
			Note(GetPluginInfo(GetPluginID(), 3))
		</send>
	</alias>
  <alias
	match="tracker tab clear"
	enabled="y"
	echo_alias="y"
	send_to="12"
	sequence="102">
		<send>
			DeleteVariable("tracker_tab")
			Note("tracker tab cleared")
		</send>
	</alias>
  <alias
	match="tracker tab"
	enabled="y"
	echo_alias="y"
	send_to="12"
	sequence="103">
		<send>
			local tab_name = GetVariable("tracker_tab") or ""
			Note("tracker tab currently set to [" .. tab_name .. "]")
		</send>
	</alias>
  <alias
	match="tracker tab *"
	enabled="y"
	echo_alias="y"
	send_to="12"
	sequence="104">
		<send>
			SetVariable("tracker_tab", "%1")
			Note("tracker tab set to [%1]")
		</send>
	</alias>

</aliases>
<!--  Script  -->


<script>
<![CDATA[

tracker_history = {}

-- functions for handling Aardwolf color codes
-- required to send color codes to Fiendish's Chat window
-- the plugin id is the plugin code for Fiendish's chat window
-- Needed for StylesToColoursOneLine function


dofile(GetInfo (66) .. "\\worlds\\plugins\\" .. "aardwolf_colors.lua")

function OnPluginSaveState ()

end -- function OnPluginSaveState

function OnPluginInstall ()

end

function ProcessTrackerMessage (name, line, wildcards, styles)
	--This part of the function sends the line to Fiendish's Chat Window
	local styles_to_colors = StylesToColoursOneLine(styles)
	local tab_name = GetVariable("tracker_tab")

	CallPlugin("b555825a4a5700c35fa80780", "storeFromOutside", styles_to_colors)
	if (tab_name) then
		CallPlugin("b555825a4a5700c35fa80780", "storeFromOutside", styles_to_colors, tab_name)
	end

	--This stuff is for the tracker channel history function
	if (#tracker_history >= 100) then
		-- Only keep last 100 so add and remove.
		tracker_history = table.remove(tracker_history, 1)
		table.insert(tracker_history, styles)
	else
		table.insert(tracker_history, styles)
	end
end -- a

function Print_Tracker_History()
	for key, value in pairs(tracker_history) do
		styles = value
			for _, v in ipairs (styles) do
				--Borrowed this code from here: http://www.gammon.com.au/forum/bbshowpost.php?bbsubject_id=9713
				--Why must printing the same line with coloring be so complicated.
				 ColourTell (RGBColourToName (v.textcolour),
								RGBColourToName (v.backcolour),
								v.text)
			end -- for each style run
		Note("") -- needed to make a new line
	end
end
]]>
</script>

</muclient>
